<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
  <title>Google Maps Multiple Markers</title>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD2AzHgsBOOR39xVgfum2FXooqON03VJrc"
          type="text/javascript"></script>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }
    #map {
      width: 100%;
      height: 100%;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <script type="text/javascript">
    // Lấy dữ liệu từ query string
    const params = new URLSearchParams(window.location.search);
    const raw = params.get("data");

    let locations = [];
    try {
      if (raw) {
        locations = JSON.parse(decodeURIComponent(raw));
      } else {
        // Dữ liệu mẫu fallback
        locations = [
          ["123#", 10.776944, 106.695274, 1],
          ["222#", 10.770497, 106.69233, 5],
          ["789#", 10.7908, 106.7056, 8]
        ];
      }
    } catch (e) {
      console.error("Lỗi khi parse data:", e);
    }

    // Khởi tạo bản đồ
    const map = new google.maps.Map(document.getElementById('map'), {
      mapTypeId: google.maps.MapTypeId.ROADMAP
    });

    const bounds = new google.maps.LatLngBounds();
    const infowindow = new google.maps.InfoWindow();

    for (let i = 0; i < locations.length; i++) {
      const position = new google.maps.LatLng(locations[i][1], locations[i][2]);
      const marker = new google.maps.Marker({
        position: position,
        map: map
      });
      bounds.extend(position);

      google.maps.event.addListener(marker, 'click', ((marker, i) => {
        return function () {
          infowindow.setContent(locations[i][0]);
          infowindow.open(map, marker);
        }
      })(marker, i));
    }

    if (locations.length > 0) {
      map.fitBounds(bounds);
    }
  </script>
</body>
</html>